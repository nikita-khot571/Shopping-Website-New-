<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Account - ShopZone</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="style.css" rel="stylesheet">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <i class="fas fa-shopping-bag me-2"></i>ShopZone
            </a>
            
            <div class="navbar-nav ms-auto flex-row">
                <a class="nav-link me-3" href="index.html">
                    <i class="fas fa-home me-1"></i>Home
                </a>
                <a class="nav-link me-3" href="cart.html">
                    <i class="fas fa-shopping-cart me-1"></i>Cart
                    <span class="badge bg-primary ms-1" id="cartCount">0</span>
                </a>
                <button class="btn btn-outline-danger btn-sm" onclick="logout()">
                    <i class="fas fa-sign-out-alt me-1"></i>Logout
                </button>
            </div>
        </div>
    </nav>

    <!-- Account Dashboard -->
    <div class="container mt-4">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-lg-3 mb-4">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-user me-2"></i>Account Menu
                        </h5>
                    </div>
                    <div class="list-group list-group-flush">
                        <a href="#profile" class="list-group-item list-group-item-action active" onclick="showSection('profile')">
                            <i class="fas fa-user me-2"></i>Profile
                        </a>
                        <a href="#orders" class="list-group-item list-group-item-action" onclick="showSection('orders')">
                            <i class="fas fa-box me-2"></i>Order History
                        </a>
                        <a href="#addresses" class="list-group-item list-group-item-action" onclick="showSection('addresses')">
                            <i class="fas fa-map-marker-alt me-2"></i>Addresses
                        </a>
                        <a href="#payments" class="list-group-item list-group-item-action" onclick="showSection('payments')">
                            <i class="fas fa-credit-card me-2"></i>Payment Methods
                        </a>
                        <a href="#settings" class="list-group-item list-group-item-action" onclick="showSection('settings')">
                            <i class="fas fa-cog me-2"></i>Settings
                        </a>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="col-lg-9">
                <!-- Profile Section -->
                <div id="profileSection" class="section-content">
                    <div class="card">
                        <div class="card-header">
                            <h4><i class="fas fa-user me-2"></i>Profile Information</h4>
                        </div>
                        <div class="card-body">
                            <div class="row mb-4">
                                <div class="col-md-3 text-center">
                                    <div class="profile-avatar">
                                        <i class="fas fa-user-circle text-primary" style="font-size: 6rem;"></i>
                                    </div>
                                    <button class="btn btn-outline-primary btn-sm mt-2">
                                        <i class="fas fa-camera me-1"></i>Change Photo
                                    </button>
                                </div>
                                <div class="col-md-9">
                                    <form id="profileForm">
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">First Name</label>
                                                <input type="text" class="form-control" id="profileFirstName">
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">Last Name</label>
                                                <input type="text" class="form-control" id="profileLastName">
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">Email</label>
                                                <input type="email" class="form-control" id="profileEmail">
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">Phone</label>
                                                <input type="tel" class="form-control" id="profilePhone">
                                            </div>
                                        </div>
                                        <button type="submit" class="btn btn-primary">
                                            <i class="fas fa-save me-2"></i>Save Changes
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Orders Section -->
                <div id="ordersSection" class="section-content" style="display: none;">
                    <div class="card">
                        <div class="card-header">
                            <h4><i class="fas fa-box me-2"></i>Order History</h4>
                        </div>
                        <div class="card-body">
                            <div id="ordersContainer">
                                <!-- Orders will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Addresses Section -->
                <div id="addressesSection" class="section-content" style="display: none;">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h4><i class="fas fa-map-marker-alt me-2"></i>Saved Addresses</h4>
                            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addAddressModal">
                                <i class="fas fa-plus me-1"></i>Add Address
                            </button>
                        </div>
                        <div class="card-body">
                            <div id="addressesContainer">
                                <!-- Addresses will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Payment Methods Section -->
                <div id="paymentsSection" class="section-content" style="display: none;">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h4><i class="fas fa-credit-card me-2"></i>Payment Methods</h4>
                            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addPaymentModal">
                                <i class="fas fa-plus me-1"></i>Add Payment Method
                            </button>
                        </div>
                        <div class="card-body">
                            <div id="paymentsContainer">
                                <!-- Payment methods will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Settings Section -->
                <div id="settingsSection" class="section-content" style="display: none;">
                    <div class="card">
                        <div class="card-header">
                            <h4><i class="fas fa-cog me-2"></i>Account Settings</h4>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <h6>Notifications</h6>
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" id="emailNotifications" checked>
                                        <label class="form-check-label" for="emailNotifications">
                                            Email notifications
                                        </label>
                                    </div>
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" id="smsNotifications">
                                        <label class="form-check-label" for="smsNotifications">
                                            SMS notifications
                                        </label>
                                    </div>
                                    <div class="form-check mb-3">
                                        <input class="form-check-input" type="checkbox" id="promotionalEmails" checked>
                                        <label class="form-check-label" for="promotionalEmails">
                                            Promotional emails
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <h6>Security</h6>
                                    <button class="btn btn-outline-primary mb-2 w-100">
                                        <i class="fas fa-key me-2"></i>Change Password
                                    </button>
                                    <button class="btn btn-outline-warning mb-2 w-100">
                                        <i class="fas fa-shield-alt me-2"></i>Two-Factor Authentication
                                    </button>
                                    <button class="btn btn-outline-danger w-100">
                                        <i class="fas fa-trash me-2"></i>Delete Account
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Address Modal -->
    <div class="modal fade" id="addAddressModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New Address</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addressForm">
                        <div class="mb-3">
                            <label class="form-label">Address Label</label>
                            <input type="text" class="form-control" placeholder="e.g., Home, Work">
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">First Name</label>
                                <input type="text" class="form-control">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Last Name</label>
                                <input type="text" class="form-control">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Street Address</label>
                            <input type="text" class="form-control">
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">City</label>
                                <input type="text" class="form-control">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">State</label>
                                <input type="text" class="form-control">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">ZIP Code</label>
                                <input type="text" class="form-control">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Country</label>
                                <select class="form-control">
                                    <option>United States</option>
                                    <option>Canada</option>
                                    <option>United Kingdom</option>
                                </select>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary">Save Address</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Payment Modal -->
    <div class="modal fade" id="addPaymentModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add Payment Method</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="paymentForm">
                        <div class="mb-3">
                            <label class="form-label">Card Number</label>
                            <input type="text" class="form-control" placeholder="1234 5678 9012 3456">
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Expiry Date</label>
                                <input type="text" class="form-control" placeholder="MM/YY">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">CVV</label>
                                <input type="text" class="form-control" placeholder="123">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Cardholder Name</label>
                            <input type="text" class="form-control">
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="makeDefault">
                            <label class="form-check-label" for="makeDefault">
                                Make this my default payment method
                            </label>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary">Save Payment Method</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script src="app.js"></script>
    <script src="graphql.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            updateCartCount();
            loadUserProfile();
            loadOrderHistory();
            loadAddresses();
            loadPaymentMethods();
        });

        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.section-content').forEach(section => {
                section.style.display = 'none';
            });
            
            // Remove active class from all menu items
            document.querySelectorAll('.list-group-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(sectionName + 'Section').style.display = 'block';
            
            // Add active class to clicked menu item
            event.target.classList.add('active');
        }

        function loadUserProfile() {
            const user = JSON.parse(localStorage.getItem('currentUser') || '{}');
            if (user.email) {
                document.getElementById('profileEmail').value = user.email || '';
                document.getElementById('profileFirstName').value = user.firstName || '';
                document.getElementById('profileLastName').value = user.lastName || '';
                document.getElementById('profilePhone').value = user.phone || '';
            }
        }

        function loadOrderHistory() {
            const orders = JSON.parse(localStorage.getItem('orders') || '[]');
            const container = document.getElementById('ordersContainer');
            
            if (orders.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-4">
                        <i class="fas fa-box text-muted" style="font-size: 3rem;"></i>
                        <h5 class="mt-3 text-muted">No orders yet</h5>
                        <p class="text-muted">Start shopping to see your orders here</p>
                        <a href="index.html" class="btn btn-primary">Shop Now</a>
                    </div>
                `;
                return;
            }

            container.innerHTML = orders.map(order => `
                <div class="card mb-3">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <div>
                                <h6 class="mb-1">Order #${order.id}</h6>
                                <small class="text-muted">Placed on ${new Date(order.date).toLocaleDateString()}</small>
                            </div>
                            <span class="badge bg-${getStatusColor(order.status)} rounded-pill">${order.status}</span>
                        </div>
                        <div class="row">
                            <div class="col-md-8">
                                <p class="mb-1"><strong>Items:</strong> ${order.items.map(item => item.name).join(', ')}</p>
                                <p class="mb-1"><strong>Shipping Address:</strong> ${order.shippingAddress}</p>
                            </div>
                            <div class="col-md-4 text-end">
                                <h5 class="text-primary">${order.total}</h5>
                                <button class="btn btn-outline-primary btn-sm">View Details</button>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function getStatusColor(status) {
            switch (status) {
                case 'Delivered': return 'success';
                case 'Shipped': return 'info';
                case 'Processing': return 'warning';
                case 'Cancelled': return 'danger';
                default: return 'secondary';
            }
        }

        function loadAddresses() {
            const addresses = JSON.parse(localStorage.getItem('addresses') || '[]');
            const container = document.getElementById('addressesContainer');
            
            if (addresses.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-4">
                        <i class="fas fa-map-marker-alt text-muted" style="font-size: 3rem;"></i>
                        <h5 class="mt-3 text-muted">No addresses saved</h5>
                        <p class="text-muted">Add an address for faster checkout</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = addresses.map((address, index) => `
                <div class="card mb-3">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <h6 class="mb-1">${address.label}</h6>
                                <p class="mb-0">${address.street}<br>${address.city}, ${address.state} ${address.zip}</p>
                            </div>
                            <div>
                                <button class="btn btn-outline-primary btn-sm me-2">Edit</button>
                                <button class="btn btn-outline-danger btn-sm">Delete</button>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function loadPaymentMethods() {
            const payments = JSON.parse(localStorage.getItem('paymentMethods') || '[]');
            const container = document.getElementById('paymentsContainer');
            
            if (payments.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-4">
                        <i class="fas fa-credit-card text-muted" style="font-size: 3rem;"></i>
                        <h5 class="mt-3 text-muted">No payment methods saved</h5>
                        <p class="text-muted">Add a payment method for faster checkout</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = payments.map((payment, index) => `
                <div class="card mb-3">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="mb-1">
                                    <i class="fas fa-credit-card me-2"></i>
                                    **** **** **** ${payment.lastFour}
                                </h6>
                                <small class="text-muted">Expires ${payment.expiry}</small>
                                ${payment.isDefault ? '<span class="badge bg-primary ms-2">Default</span>' : ''}
                            </div>
                            <div>
                                <button class="btn btn-outline-primary btn-sm me-2">Edit</button>
                                <button class="btn btn-outline-danger btn-sm">Remove</button>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function logout() {
            localStorage.removeItem('currentUser');
            window.location.href = 'index.html';
        }
    </script>
</body>
</html>